# Get the current user's object ID
currentUserObjectId=$(az ad signed-in-user show --query objectId -o tsv)

# List all subscriptions and iterate over them
az account list --query "[].id" -o tsv | while read subscriptionId; do
    echo "Processing subscription: $subscriptionId"

    # Set the context to the current subscription
    az account set --subscription "$subscriptionId"

    # Optionally, assign the Owner role to the user for the subscription itself
    az role assignment create --assignee "$currentUserObjectId" --role "Owner" --scope "/subscriptions/$subscriptionId"

    # List all resource groups in the subscription
    az group list --query "[].name" -o tsv | while read resourceGroupName; do
        echo "Assigning Owner role for resource group: $resourceGroupName in subscription: $subscriptionId"
        
        # Assign the Owner role to the user for each resource group
        az role assignment create --assignee "$currentUserObjectId" --role "Owner" --scope "/subscriptions/$subscriptionId/resourceGroups/$resourceGroupName"
    done
done